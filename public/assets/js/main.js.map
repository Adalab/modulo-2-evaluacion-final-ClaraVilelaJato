{"version":3,"sources":["main.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"main.js","sourcesContent":["'use strict';\n//Nos traemos de html los elementos para trabajar con ellos en JS\n\nconst inputShow = document.querySelector('.js-searchinput');\nconst searchButton = document.querySelector('.js-search-btn');\nconst reset = document.querySelector('.reset__btn');\nconst resultsContainer = document.querySelector('.js-list-results'); //selecciono el elem. de html donde pintaré los resultados\nconst paintedFavs = document.querySelector('.js-favs');\nlet apiDataShows = []; //array donde almaceno resultados del api\n\nlet favorites = []; //array donde almaceno favoritos\n\n//Función para hacer petición al servidor\n\nfunction fetchToApi() {\n  let inputShowValue = inputShow.value.toLocaleLowerCase();\n  fetch(`https://api.tvmaze.com/search/shows?q=${inputShowValue}`)\n    .then((response) => response.json())\n    .then((data) => {\n      apiDataShows = data; //guardo los datos del api en el array global\n    });\n  paintShows(); //incluyo la funcion painShows para que se me pinten los datos en cada petición\n}\n\n//Declaro la función para guardar en localStorage\nfunction setInLocalStorage() {\n  // stringify me permite transformar a string el array de favorites\n  const stringShows = JSON.stringify(favorites);\n  //añadimos  al localStorage  los datos convertidos en string previamente\n  localStorage.setItem('favorites', stringShows);\n}\n\nfunction getLocalStorage() {\n  // obtengo lo que hay en el LS\n  const localStorageLoaded = localStorage.getItem('favorites');\n  // cojo datos del local storage y compruebo si son válidos\n  if (localStorageLoaded === null) {\n    // no tengo datos en el local storage, así que llamo al API\n    fetchToApi();\n  } else {\n    //tengo datos en el local storage,lo parseo a un array y\n    const arrayFavorites = JSON.parse(localStorageLoaded);\n    // lo guardo en la variable global de favorites\n    favorites = arrayFavorites;\n\n    paintFavs();\n  }\n}\n\n//declaro la función manejadora del evento click que está asociado al botón search\nfunction handleSearch(ev) {\n  ev.preventDefault();\n  fetchToApi();\n}\n//Añadimos evento que desencadena la funcion fetch al pulsar el boton, nos traemos los datos del api\nsearchButton.addEventListener('click', handleSearch);\n\n// 1- -- Cuando carga la pagina\ngetLocalStorage();\n\n//Esta función es la encargada de manejar el evento click (listenShows) sobre cada uno de los li de paintShows\nfunction handleShows(ev) {\n  const pickedShow = parseInt(ev.currentTarget.id); //los datos del id que recogemos de html son un string y los que recogemos del api number, así que los convierto a number con parseInt\n\n  //a continuación aplico el metodo find al array apidatashows, de cada show le digo que me encuentre su id y comparo si es el mismo que el de html\n  const objectClickedShow = apiDataShows.find((show) => {\n    return show.show.id === pickedShow;\n  });\n  //del array de favoritos busco su posición en el array\n  const favoritesFound = favorites.findIndex((fav) => {\n    return fav.show.id === pickedShow;\n  });\n\n  if (favoritesFound === -1) {\n    // añado al array de favoritos\n    favorites.push(objectClickedShow);\n  } else {\n    // si el findIndex me ha devuelto un número mayor o igual a 0 es que sí está en el array de favoritos\n    // quiero sacarlo de array de favoritos\n    // para utilizar splice necesito el índice del elemento que quiero borrar\n    // y quiero borrar un solo elemento por eso colocamos 1\n    favorites.splice(favoritesFound, 1);\n  }\n  //console.log(favorites);\n  paintShows();\n  paintFavs();\n  setInLocalStorage();\n}\n\nfunction listenShows() {\n  const showList = document.querySelectorAll('.js-picked'); //selecciono los li que creé con la funcion paintShows, a continuación los recorro con un bucle y añado el tipo de evento y la función manejadora cuando el evento se desencadene.\n  for (const show of showList) {\n    show.addEventListener('click', handleShows);\n  }\n}\n\n//Declaro una función para manejar el evento click sobre las X del listado de favoritos\n//el funcionamiento es muy similar al de la función handleShows, usando el metodo findIndex para saber si en el array está el elemento que tenga el mismo id que el elemento que estamos escuchando cen el evento click.\nfunction handleX(ev) {\n  const showToClose = parseInt(ev.currentTarget.id);\n  const favoritesFound = favorites.findIndex((fav) => {\n    return fav.show.id === showToClose;\n  });\n  if (favoritesFound === -1) {\n    // y lo quito\n    favorites.splice(favoritesFound, 1);\n  }\n  paintFavs();\n  paintShows();\n  setInLocalStorage();\n}\n//declaro esta funcion para añadir cuando se pinten los favoritos, manejada por la función handleX\nfunction closeX() {\n  const listX = document.querySelectorAll('.close-fav');\n  for (let x of listX) {\n    x.addEventListener('click', handleX);\n    //console.log(listX);\n  }\n}\n\n//código botón de reset, me vacías el array y el html de los elementos con clase .js-favs, limpias el localStorage con el método clear\n\nfunction handleresetFavs() {\n  favorites = [];\n  paintedFavs.innerHTML = '';\n  localStorage.clear();\n}\n\nreset.addEventListener('click', handleresetFavs); //añado el evento click al botón\n\n//esta funcion la incluimos en la funcion fecth, cuando recibimos los datos solicitados los pintamos en el html\nfunction paintShows() {\n  let html = '';\n  let favClass = '';\n  for (const eachSerie of apiDataShows) {\n    const oneSerie = eachSerie.show;\n    const isFav = isFavorite(oneSerie); //guardo esta funcion (declarada en la linea 181) con oneSerie como parámetro dentro de la constante isfav. Si es true añado la clase, si no vacio, para usarla al pintar los li y darle un css diferente.\n    if (isFav) {\n      favClass = 'js-selected-list';\n    } else {\n      favClass = '';\n    }\n    let image = '';\n    if (oneSerie.image === null) {\n      image = 'https://via.placeholder.com/210x295/ffffff/666666/?text=TV';\n    } else {\n      image = oneSerie.image.medium;\n    }\n    html += `<li id=\"${oneSerie.id}\" class=\"serie__box js-picked ${favClass}\">`;\n    html += `<div class=\"border-show\">`;\n    html += `<img class=\"list-image\" src=\"${image}\" alt=\"${oneSerie.name}\">`;\n    html += `<h3 class=\"serie__name\">${oneSerie.name}</h3></li>`;\n    html += `</div>`;\n  }\n  resultsContainer.innerHTML = html;\n  listenShows();\n}\n\nfunction paintFavs() {\n  let html = '';\n  paintedFavs.innerHTML = '';\n  for (let favorite of favorites) {\n    const favoriteShow = favorite.show;\n    let image = '';\n    if (favoriteShow.image === null) {\n      image = 'https://via.placeholder.com/210x295/ffffff/666666/?text=TV';\n    } else {\n      image = favoriteShow.image.medium;\n    }\n    html += `<button value=\"x\" class=\"close-fav\">x</button><li id=\"${favoriteShow.id}\" class=\"fav__card\">`;\n    html += `<img class=\"fav__image\" src=\"${image}\" alt=\"${favoriteShow.name}\">`;\n    html += `<h3 class=\"fav__name\">${favoriteShow.name}</h3></li>`;\n  }\n  paintedFavs.innerHTML = html;\n  closeX();\n}\n\n//funcion para añadir una clase para dar estilos diferentes a los favoritos que se encuentren el array favorites cuando utilizo paintShows\n\nfunction isFavorite(oneSerie) {\n  const favoriteFound = favorites.find((fav) => {\n    return fav.show.id === oneSerie.id;\n  });\n  if (favoriteFound === undefined) {\n    return false;\n  } else {\n    return true;\n  }\n}\n"]}